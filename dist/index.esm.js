import{z as t}from"zod";import e from"cross-fetch";var r=t.object({name:t.string(),args:t.any().array()}),n=r.extend({type:t.literal("single")}),o=t.object({type:t.literal("group"),content:r.array()}),s=t.object({status:t.literal("fulfilled"),value:t.any()}),a=t.object({status:t.literal("rejected"),reason:t.any()}),c=s.or(a),i=c,u=c.array(),f=i.or(u),l=n.or(o),p=t.object({name:t.string(),message:t.string(),cause:t.any().optional(),stack:t.string().optional()});function h(){return h=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},h.apply(this,arguments)}function y(t){return y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},y(t)}function v(t,e){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},v(t,e)}function m(t,e,r){return m=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct.bind():function(t,e,r){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return r&&v(o,r.prototype),o},m.apply(null,arguments)}function d(t){var e="function"==typeof Map?new Map:void 0;return d=function(t){if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return m(t,arguments,y(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),v(r,t)},d(t)}function g(t){return t instanceof Error?{message:t.message,name:t.name,cause:t.cause,stack:t.stack}:(console.log(t),h({},t))}function b(t){var e=p.safeParse(t);if(e.success){var r=e.data;return new(/*#__PURE__*/function(t){var e,n;function o(){for(var e,n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))||this).name=r.name,e.message=r.message,e.cause=r.cause,e.stack=r.stack,e}return n=t,(e=o).prototype=Object.create(n.prototype),e.prototype.constructor=e,v(e,n),o}(/*#__PURE__*/d(Error)))}return new Error(t)}var P,j=/*#__PURE__*/function(){function t(t,e,r){this.url=void 0,this.fnName=void 0,this.fnArgs=void 0,this.url=t,this.fnName=e,this.fnArgs=r}var r=t.prototype;return r.single=function(){try{var t=this;try{return Promise.resolve(e(t.url,{method:"POST",body:JSON.stringify({type:"single",name:t.fnName,args:t.fnArgs}),headers:{"Content-Type":"application/json"}}).then(function(t){return t.json()}).then(function(t){return i.safeParse(t)}).then(function(t){if(t.success)return t.data;throw new Error("bad Response")}).then(function(t){if("fulfilled"===t.status)return t.value;throw b(t.reason)}))}catch(t){throw new Error("bad Response")}}catch(t){return Promise.reject(t)}},r.then=function(t,e){return this.single().then(t,e)},t}();function w(t,e){var r=new Proxy({},{get:function(t,r,n){if("$"===r)throw new Error("not implemented");return function(){try{var t=arguments;return Promise.resolve(new j(e,r.toString(),[].slice.call(t)))}catch(t){return Promise.reject(t)}}}});return r}var O=Symbol("Base");t.object(((P={})[O]=t.literal(!0).default(!0),P));var E=/*#__PURE__*/function(){function t(t,e,r){this.context=void 0,this.functions=void 0,this.shape=void 0,this.context=r;var n=t.safeParse(e);if(!n.success)throw new Error("Functions are not compatable");this.functions=n.data,this.shape=t.shape}var e=t.prototype;return e.call=function(t,e,r){try{var n=this;if(Object.hasOwn(n.functions,t)){var o,s,a,c=n.functions[t];return!(null==(o=n.shape[t].parameters().items)||null==(s=o[0])||null==(a=s.shape)||!a[O])&&(e=[r].concat(e)),Promise.resolve(function(t,r){try{var n=Promise.resolve(c.apply(void 0,e)).then(function(t){return{status:"fulfilled",value:t}})}catch(t){return r(t)}return n&&n.then?n.then(void 0,r):n}(0,function(t){return{status:"rejected",reason:g(t)}}))}var i={status:"rejected",reason:g(new Error("Function Not Found"))};return Promise.resolve(i)}catch(t){return Promise.reject(t)}},e.single=function(t,e){try{var r=t.args,n=t.name;if(Object.hasOwn(this.functions,n))return Promise.resolve(this.call(n,r,e));throw new Error("Not found")}catch(t){return Promise.reject(t)}},e.group=function(t,e){try{var r=this;return Promise.resolve(Promise.allSettled(t.content.map(function(t){try{return Promise.resolve(r.single(t,e))}catch(t){return Promise.reject(t)}})))}catch(t){return Promise.reject(t)}},e.handle=function(t,e){try{var r=this,n=r.context.safeParse(e);if(!n.success)throw new Error("Bad Context");var o=n.data,s=l.safeParse(t);if(!s.success)throw new Error("Bad Request form",{cause:s.error.message});var a=s.data;return Promise.resolve("single"===a.type?r.single(a,o):r.group(a,o))}catch(t){return Promise.reject(t)}},t}();export{r as BaseRequest,c as BaseResponse,s as BaseResponseFullfilled,a as BaseResponseRejected,g as ErrorToJson,o as GroupRequest,u as GroupResponse,E as Handler,b as JsonToError,p as MixinError,l as MixinRequest,f as MixinResponse,n as SingleRequest,i as SingleResponse,w as compile};
//# sourceMappingURL=index.esm.js.map
