!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("zod"),require("cross-fetch")):"function"==typeof define&&define.amd?define(["exports","zod","cross-fetch"],t):t((e||self).microz={},e.zod,e.crossFetch)}(this,function(e,t,r){function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=/*#__PURE__*/n(r),s=t.z.object({name:t.z.string(),args:t.z.any().array()}),i=s.extend({type:t.z.literal("single")}),a=t.z.object({type:t.z.literal("group"),content:s.array()}),c=t.z.object({status:t.z.literal("fulfilled"),value:t.z.any()}),u=t.z.object({status:t.z.literal("rejected"),reason:t.z.any()}),f=c.or(u),l=f,p=f.array(),h=l.or(p),d=i.or(a),y=t.z.object({name:t.z.string(),message:t.z.string(),cause:t.z.any().optional(),stack:t.z.string().optional()});function v(){return v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},v.apply(this,arguments)}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}function g(e,t){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},g(e,t)}function b(e,t,r){return b=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&g(o,r.prototype),o},b.apply(null,arguments)}function j(e){var t="function"==typeof Map?new Map:void 0;return j=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return b(e,arguments,m(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),g(r,e)},j(e)}function P(e){return e instanceof Error?{message:e.message,name:e.name,cause:e.cause,stack:e.stack}:(console.log(e),v({},e))}function w(e){var t=y.safeParse(e);if(t.success){var r=t.data;return new(/*#__PURE__*/function(e){var t,n;function o(){for(var t,n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(t=e.call.apply(e,[this].concat(o))||this).name=r.name,t.message=r.message,t.cause=r.cause,t.stack=r.stack,t}return n=e,(t=o).prototype=Object.create(n.prototype),t.prototype.constructor=t,g(t,n),o}(/*#__PURE__*/j(Error)))}return new Error(e)}var O,z=/*#__PURE__*/function(){function e(e,t,r){this.url=void 0,this.fnName=void 0,this.fnArgs=void 0,this.url=e,this.fnName=t,this.fnArgs=r}var t=e.prototype;return t.single=function(){try{var e=this;try{return Promise.resolve(o.default(e.url,{method:"POST",body:JSON.stringify({type:"single",name:e.fnName,args:e.fnArgs}),headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){return l.safeParse(e)}).then(function(e){if(e.success)return e.data;throw new Error("bad Response")}).then(function(e){if("fulfilled"===e.status)return e.value;throw w(e.reason)}))}catch(e){throw new Error("bad Response")}}catch(e){return Promise.reject(e)}},t.then=function(e,t){return this.single().then(e,t)},e}(),R=Symbol("Base");t.z.object(((O={})[R]=t.z.literal(!0).default(!0),O));var x=/*#__PURE__*/function(){function e(e,t,r){this.context=void 0,this.functions=void 0,this.shape=void 0,this.context=r;var n=e.safeParse(t);if(!n.success)throw new Error("Functions are not compatable");this.functions=n.data,this.shape=e.shape}var t=e.prototype;return t.call=function(e,t,r){try{var n=this;if(Object.hasOwn(n.functions,e)){var o,s,i,a=n.functions[e];return!(null==(o=n.shape[e].parameters().items)||null==(s=o[0])||null==(i=s.shape)||!i[R])&&(t=[r].concat(t)),Promise.resolve(function(e,r){try{var n=Promise.resolve(a.apply(void 0,t)).then(function(e){return{status:"fulfilled",value:e}})}catch(e){return r(e)}return n&&n.then?n.then(void 0,r):n}(0,function(e){return{status:"rejected",reason:P(e)}}))}var c={status:"rejected",reason:P(new Error("Function Not Found"))};return Promise.resolve(c)}catch(e){return Promise.reject(e)}},t.single=function(e,t){try{var r=e.args,n=e.name;if(Object.hasOwn(this.functions,n))return Promise.resolve(this.call(n,r,t));throw new Error("Not found")}catch(e){return Promise.reject(e)}},t.group=function(e,t){try{var r=this;return Promise.resolve(Promise.allSettled(e.content.map(function(e){try{return Promise.resolve(r.single(e,t))}catch(e){return Promise.reject(e)}})))}catch(e){return Promise.reject(e)}},t.handle=function(e,t){try{var r=this,n=r.context.safeParse(t);if(!n.success)throw new Error("Bad Context");var o=n.data,s=d.safeParse(e);if(!s.success)throw new Error("Bad Request form",{cause:s.error.message});var i=s.data;return Promise.resolve("single"===i.type?r.single(i,o):r.group(i,o))}catch(e){return Promise.reject(e)}},e}();e.BaseRequest=s,e.BaseResponse=f,e.BaseResponseFullfilled=c,e.BaseResponseRejected=u,e.ErrorToJson=P,e.GroupRequest=a,e.GroupResponse=p,e.Handler=x,e.JsonToError=w,e.MixinError=y,e.MixinRequest=d,e.MixinResponse=h,e.SingleRequest=i,e.SingleResponse=l,e.compile=function(e,t){var r=new Proxy({},{get:function(e,r,n){if("$"===r)throw new Error("not implemented");return function(){try{var e=arguments;return Promise.resolve(new z(t,r.toString(),[].slice.call(e)))}catch(e){return Promise.reject(e)}}}});return r}});
//# sourceMappingURL=index.umd.js.map
